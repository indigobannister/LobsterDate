---
title: 'Analysis of Lobster Abundance along the Santa Barbara Coast'
author: "Indigo Bannister & Gavriella Keyles"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


```{r}
# In order to install extrafont, use following code in the console:
## install.packages("extrafont")

# In order to install NPS colors, use following code in the console:
## install.packages("devtools")
## devtools::install_github("katiejolly/nationalparkcolors") - request help loading

# Attach packages
library(tidyverse)
library(tidyr)
library(here)
library(janitor)
library(ggridges)
library(viridis)
library(plotly)
library(extrafont)
#library(nationalparkcolors)

# Load fonts
loadfonts()

# Read in data file: lobster_abundance_sbc_lter.csv
lobster_abun <- read_csv(here("raw_data","lobster_abundance_sbc_lter.csv"),
                         na = "-99999")

# Clean lobster_abun dataframe: update column names and make data tidy, add column and attribute full site names
lobster_clean <- lobster_abun %>% 
  clean_names() %>% 
  tidyr::uncount(count) %>% 
    mutate(site_name = 
           ifelse(site == "IVEE", "Isla Vista",
         ifelse(site == "AQUE", "Arroyo Quemado",
         ifelse(site == "CARP", "Carpinteria",
         ifelse(site == "NAPL", "Naples", "Mohawk"))))) 

```

### Introduction
Gavi to write paragraph here on introduction. 

![**Figure 1:** California Spiny Lobsters off Anacapa Island. Photographer: [Ed Bierman](https://www.flickr.com/people/26216388@N02).](images/California_Spiny_Lobster.jpg)


### Data & Methods
Indigo to write paragraph here about data and methods.

### Results
#### 1. Annual lobster abundance by site, 2012-2018
**Analysis:** Figure 2 demonstrates varying trends in lobster abundance among the 5 collection sites. At Isla Vista and Naples, both located within Marine Protected Areas, lobster abundance trends positive over the duration. Both MPA sites saw spikes in 2015, declines in 2016 followed by increases in population. At non-MPA sites, counts are highly variable and characteristics between sites are not shared. At Arroyo Quemado, lobster counts remained relatively stable over the studied time period. At Carpinteria, a major spike in lobster abundance (2017) was followed by a major decline (2018). At Mohawk, a spike in abundance in 2015 gives way to stability into 2018.

```{r}
# Create filtered dataframe for abundance graph
lobster_a <- lobster_clean %>% 
  select(year, site_name) %>% 
  count(year, site_name) %>% 
  rename(annual_total = n)

# Create graph of lobster abundance from 2012 to 2018
graph_a <- ggplot(lobster_a, aes(color = site_name, x = year, y = annual_total)) +
  geom_line() +
  theme_minimal() +
  scale_color_viridis (discrete = TRUE, 
                       name = "Site") +
  labs(
    x = "",
    y = "Total lobsters counted",
    title = "Year-over-year lobster count change",
    subtitle = "Santa Barbara County") +
  theme(plot.title = element_text(hjust = 0.5)) + 
  scale_x_continuous(limits = c(2012, 2018),
                     expand = c(0,0),
                     breaks = seq(2012, 2018, by = 2)) + 
  scale_y_continuous(breaks = seq(0, 1000, by = 200))

# Make graph_a interactive with ggplotly 
ggplotly(graph_a, tooltip = c("site_name", "x", "y")) %>%
  config(displayModeBar = FALSE)

# This website has lots of resources to customize ggplotly https://plotly-r.com/controlling-tooltips.html 
  
```

**Figure 2:** **Year-over-year change, lobsters counted in 5 Santa Barbara Channel sites, 2012-2018.** Annual lobsters counts based on data collected by divers before the start of fishing season in late summer at five sites, two of which (Isla Vista and Naples) are within Marine Protected Areas (MPA). **Interactive:** double-click on individual site within legend to highlight. Single-click and unclick sites to toggle visibility and compare site data.

#### 2. Lobster size: 2012 to 2018
Add description of analysis here. 

```{r}
# Create two dataframes filtered for size analysis, one for lobster size data in 2012 and the other for 2018
lobster_2018 <- lobster_clean %>% 
  select(year, size_mm, site_name) %>% 
  filter(year %in% c(2018))

lobster_2012 <- lobster_clean %>% 
  select(year, size_mm, site_name) %>% 
  filter(year %in% c(2012))

# Create graph of lobster size distribution for 2012 and 2018 at each site
graph_b <- ggplot() +
  geom_density_ridges(data = lobster_2012, 
                      aes(x = size_mm, y = site_name), 
                      fill = "firebrick", 
                      color = "white", 
                      alpha = 0.5,
                      scale = 0.9) +
    geom_density_ridges(data = lobster_2018, 
                      aes(x = size_mm, y = site_name), 
                      fill = "skyblue4",
                      color = "white",
                      alpha = 0.5,
                      scale = 0.9) +
  theme_minimal() +
  labs(x = "Lobster size (mm)",
       y = "Study sites")

# Call graph_b
graph_b

# Talk to Gavi about x-scale and best way to give better labels to y-axis - believe we may need to factor so that MPAs are adjacent

```

**Figure 3:** Add figure caption here

#### 3. Analysis of lobsters in marine protected areas versus non-protected areas
Add description of analysis here. 

```{r}
# Part C

#Cleaning the data, used mutate and ifelse statement to make new MPA status variable. Boom!

lobster_c <- lobster_clean %>% 
  mutate(mpa_status = 
           ifelse(site %in% c("IVEE", "NAPL"), "MPA", "non-MPA"))
```


### Summary

### References
**Reed D. 2019.** [SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012.](https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0) Environmental Data Initiative. Dataset accessed 10/30/2019.
