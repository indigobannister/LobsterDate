---
title: 'Analysis of Lobster Size & Abundance Along the Santa Barbara Coast'
author: "Indigo Bannister & Gavriella Keyles"
date: "November 18, 2019"
output: 
  html_document: 
    css: bootstrap.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE)
```


```{r}
# In order to install extrafont, use following code in the console:
## install.packages("extrafont")

# In order to install NPS colors, use following code in the console:
## install.packages("devtools")
## devtools::install_github("katiejolly/nationalparkcolors")

# Attach packages
library(tidyverse)
library(tidyr)
library(here)
library(janitor)
library(ggridges)
library(plotly)
library(extrafont)
library(nationalparkcolors)
library(kableExtra)
library(effsize)

# Load fonts
loadfonts()

# Read in data file: lobster_abundance_sbc_lter.csv
lobster_abun <- read_csv(here("raw_data","lobster_abundance_sbc_lter.csv"),
                         na = "-99999")

# Clean lobster_abun dataframe: update column names and make data tidy, add column and attribute full site names, factor site_name to group MPAs adjacent to one another
lobster_clean <- lobster_abun %>% 
  clean_names() %>% 
  tidyr::uncount(count) %>% 
    mutate(site_name = 
           ifelse(site == "IVEE", "Isla Vista",
         ifelse(site == "AQUE", "Arroyo Quemado",
         ifelse(site == "CARP", "Carpinteria",
         ifelse(site == "NAPL", "Naples", "Mohawk"))))) %>% 
  mutate(site_name = factor(site_name, levels = c("Isla Vista","Naples","Arroyo Quemado","Carpinteria","Mohawk") ))

```
\

### Introduction
The Santa Barbara Channel is home to many marine organisms including marine mammals, seabirds, invertebrates and fish. California spiny lobsters (*Panulirus interruptus*) are an important species in the giant kelp forests of the Channel. From October through March, Spiny lobsters are subject to both sport and commercial fishing through the use of hoop nets and lobster traps (CDFW, 2019). The commercial fishery revenue in 2016 was almost $16 million, making it the third highest grossing fishery in California (CDFW, 2017). 

The Santa Barbara Coastal Long-Term Ecological Research (SBC LTER) is an interdiscplinary research program focused on the nearshore waters of Southern California, including the Santa Barbara Channel. The SBC LTER tracks spiny lobster abundance and size in five sites along the channel: Naples, Isla Vista, Carpinteria, Arroyo Quemado, and Mohawk. Naples and Isla Vista are located in or near Marine Protected Areas (MPA) that were established on January 1, 2012 by California Fish and Wildlife. Both recreational and commercial fishing is prohibited within the MPAs, allowing for an opportunity to examine the impacts of fishing on lobster abundance and size.

In this analysis, we use data provided by SBC LTER to explore differences in lobster size and abundance among the five sites, between 2012 and 2018. Analysis suggests that, over time, sites located *within* MPAs saw increased lobster abundance and size between 2012 and 2018. For non-MPA sites, changes in size and abundance are less clear. This may suggest that protected areas allow lobsters to grow and reproduce better than than non-protected areas.


<center>
![](images/California_Spiny_Lobster.jpg){ width=75% }
\center

<font size="2"> **Figure 1:** California Spiny Lobsters off Anacapa Island. Photographer: [Ed Bierman</font>](https://www.flickr.com/people/26216388@N02).

### Data & Methods
Data for California spiny lobster abundance and size along the Santa Barbara Coast, 2012-2018, were collected by the [Santa Barbara Coastal Long Term Ecological Research group](https://sbclter.msi.ucsb.edu/). Lobsters were surveyed at five long-term kelp forest study sites. Two of the sites were located within or near MPAs (Naples and Isla Vista) and three were outside of a MPA (Arroyo Quemado, Mohawk, and Carpinteria). Lobsters were counted and sizes estimated visually by divers in late summer before fishing season began. For more information on the methods, see the project [metadata](https://portal.edirepository.org/nis/metadataviewer?packageid=knb-lter-sbc.77.3). 

Mean lobster size (mm) was compared for 2012 and 2018 at the non-MPA and MPA sites by two-sample t-tests ($\alpha$ = 0.05 throughout) and analyzed using Cohen's Effect Size. In addition, mean lobster size was compared  pre-MPA (2012) and post-MPA (2018). All analyses and figures were prepared using R software version 3.6.1.


\

### Results

#### 1. Annual lobster abundance by site, 2012-2018
Figure 2 demonstrates varying trends in lobster abundance among the 5 collection sites. At Isla Vista and Naples, both located within Marine Protected Areas, lobster abundance trends positive after the MPAs were established in 2012. Both MPA sites saw spikes in 2015, and declines in 2016 followed by increases in population. At non-MPA sites, counts are highly variable and characteristics between sites are not shared. At Arroyo Quemado, lobster counts remained relatively stable over the studied time period. At Carpinteria, a major spike in lobster abundance (2017) was followed by a major decline (2018). At Mohawk, a spike in abundance in 2015 gives way to stability into 2018.

```{r}
# Create filtered dataframe for abundance graph
lobster_a <- lobster_clean %>% 
  select(year, site_name) %>% 
  count(year, site_name) %>% 
  rename(annual_total = n)

# Create a custom palette for colors in graph_a
site_colors <- park_palette("Everglades")
```


```{r,fig.align="center",out.width="100%"}
# Create graph of lobster abundance from 2012 to 2018
graph_a <- ggplot(lobster_a, ) +
  geom_line( aes(color = site_name, 
                 x = year, 
                 y = annual_total,
                 text = paste('Site:', site_name,
                          '<br>Total:', annual_total),
                 group = 1)) +
  theme_minimal() +
  scale_color_manual(values = site_colors, name = "Site") +
  labs(
    x = "",
    y = "Total lobsters counted") +
  theme(plot.title = element_text(hjust = 0.5))+
  scale_x_continuous(limits = c(2012, 2018),
                     expand = c(0,0),
                     breaks = seq(2012, 2018, by = 1)) + 
  scale_y_continuous(breaks = seq(0, 1000, by = 200),
                     expand = c(0,0))

# Make graph_a interactive with ggplotly 
ggplotly(graph_a, tooltip = "text") %>%
  layout(legend = list(x = 0.05, y = 0.85)) %>% 
  config(displayModeBar = FALSE)

```

<font size="2"> ***Figure 2: Year-over-year change, lobsters counted in 5 Santa Barbara Channel sites, 2012-2018.*** *Annual lobsters counts based on data collected by divers before the start of fishing season in late summer at five sites, two of which (Isla Vista and Naples) are within Marine Protected Areas (MPAs).* ***Interactive:*** *Double-click on individual site within legend to highlight. Single-click and unclick sites within legend to toggle visibility and compare site data.*</font>

\

#### 2. Lobster size: 2012 and 2018
```{r}
# Create two dataframes filtered for size analysis, one for lobster size data in 2012 and the other for 2018
lobster_2018 <- lobster_clean %>% 
  select(year, size_mm, site_name) %>% 
  filter(year %in% c(2018))

lobster_2012 <- lobster_clean %>% 
  select(year, size_mm, site_name) %>% 
  filter(year %in% c(2012))

# Create two dataframes with calculated medians for lobster size in 2012 and 2018 at each site
lobster_2018_med <- lobster_2018 %>% 
  group_by(site_name) %>% 
  summarize(median = median(size_mm))

lobster_2012_med <- lobster_2012 %>% 
  group_by(site_name) %>% 
  summarize(median = median(size_mm))
```
Figure 3 depicts size distribution trends among spiny lobsters in 2012 and 2018 at the five collection sites. Both sites that established MPAs in 2012 (Isla Vista and Naples) had more lobsters of a larger size by 2018 than they did when the MPAs were established. Median size for Isla Vista lobsters increased from `r lobster_2012_med$median[1]` mm to `r lobster_2018_med$median[1]` mm, while median sizes for Naples lobsters increased from `r lobster_2012_med$median[2]` mm to `r lobster_2018_med$median[2]` mm.

Lobster sizes at the non-MPA sites stayed relateively stable and did not see major shifts in median size between 2012 and 2018.

```{r,fig.align="center",fig.width=10,fig.height=7}
# Create graph of lobster size distribution for 2012 and 2018 at each site
graph_b <- ggplot() +
  geom_density_ridges(data = lobster_2012, 
                      aes(x = size_mm, y = reorder(site_name, desc(site_name))), 
                      fill = "#2E8289", 
                      color = "white", 
                      alpha = 0.5,
                      scale = 0.9) +
    geom_density_ridges(data = lobster_2018, 
                      aes(x = size_mm, y = reorder(site_name, desc(site_name))), 
                      fill = "#EAAE37",
                      color = "white",
                      alpha = 0.4,
                      scale = 0.9) +
  theme_minimal() +
  labs(x = "Lobster size (mm)",
       y = "Study sites") + 
  scale_x_continuous(limits = c(40,120))+
  annotate("text", x = 116, y = 1.75, label = "2012", color = "#2E8289", fontface = 2, size = 5)+
  annotate("text", x = 116, y = 1.5, label = "2018", color = "#EAAE37", fontface = 2, size = 5) +
  annotate(geom = "rect", color = "black", alpha = 0, xmin = 110, xmax = 120, ymin = 1.3, ymax = 1.95)+
  annotate(geom = "point", x = 112, y = 1.75, color = "#2E8289", size = 4, alpha = .4) +
  annotate(geom = "point", x = 112, y = 1.5, color = "#EAAE37", size = 4, alpha = .4)+
  annotate("text", x = 115, y = 2.1, label = "Year", color = "black", size = 5)
#annotate("text", x = 115, y = 2.15, label = "Legend", color = "black", fontface = 2, size = 4)

# Call graph_b
graph_b

```

<font size="2"> ***Figure 3: Comparison of distribution of sampled lobster size at five sampling sites, 2012 & 2018.***
*Distribution of lobster size at five sampling sites in two different years, 2012 and 2018. Two of the five sites (Isla Vista and Naples) established Marine Protected Areas (MPAs) in 2012. These two sites had more lobsters of larger size in 2018 than in 2012. The other three sites not in MPAs had more consistent size distribution across the two years.* </font>

\

#### 3. Analysis of lobsters in marine protected areas versus non-protected areas
In order to assess whether MPA status had an impact on lobster size and abundance,  statistical testing (Student's T Test and Cohen's Effect Size) was used to compare sites located within and outside MPAs in 2012 and 2018.

```{r, include = FALSE}
# Part C

# Cleaning the data, used mutate and ifelse statement to make new MPA status variable.
lobster_c <- lobster_clean %>% 
  mutate(mpa_status = 
           ifelse(site %in% c("IVEE", "NAPL"), "MPA", "non-MPA"))

# Create dataframes to insert into t-tests for Part C 1 & 2
mpa_size_compare_2012 <- lobster_c %>% 
  select(mpa_status, size_mm, year) %>% 
  filter(year == "2012", mpa_status == "MPA") %>% 
  pull(size_mm)

non_mpa_size_compare_2012 <- lobster_c %>% 
  select(mpa_status, size_mm, year) %>% 
  filter(year == "2012", mpa_status == "non-MPA") %>% 
  pull(size_mm)

mpa_size_compare_2018 <- lobster_c %>% 
  select(mpa_status, size_mm, year) %>% 
  filter(year == "2018", mpa_status == "MPA") %>% 
  pull(size_mm)

non_mpa_size_compare_2018 <- lobster_c %>% 
  select(mpa_status, size_mm, year) %>% 
  filter(year == "2018", mpa_status == "non-MPA") %>% 
  pull(size_mm)

# Run t-tests for 2012 and 2018 in MPA vs. non-MPA
size_ttest_2012 <- t.test(mpa_size_compare_2012, non_mpa_size_compare_2012)
cohen_2012 <- cohen.d(mpa_size_compare_2012, non_mpa_size_compare_2012)

size_ttest_2012
cohen_2012

size_ttest_2018 <- t.test(mpa_size_compare_2018, non_mpa_size_compare_2018)
cohen_2018 <- cohen.d(mpa_size_compare_2018, non_mpa_size_compare_2018)

size_ttest_2018
cohen_2018

## Run t-tests for MPA and non-MPA for 2012 vs. 2018
ttest_MPA <- t.test(mpa_size_compare_2012, mpa_size_compare_2018)
cohen_MPA <- cohen.d(mpa_size_compare_2012, mpa_size_compare_2018)

ttest_MPA
cohen_MPA

ttest_nonMPA <- t.test(non_mpa_size_compare_2012, non_mpa_size_compare_2018)
cohen_nonMPA <- cohen.d(non_mpa_size_compare_2012, non_mpa_size_compare_2018)

ttest_nonMPA
cohen_nonMPA
  


```

<font size="2"> ***Table 1: Comparison of statistical distribution for MPA versus non-MPA sampling sites in 2012 and 2018.***
*Comparison of mean lobster size (mm), standard deviation (mm), and sample size at sites within and outside of a Marine Protected Area (MPA) in 2012 and 2018.* </font>

```{r}
# Part C continued - create table of results

# Create df of summary stats: mean, std dev, and sample size
lobster_sum <- lobster_c %>% 
  filter(year %in% c(2012, 2018)) %>% 
  group_by(year, mpa_status) %>%
  summarize(mean = round(mean(size_mm),2),
            std_dev = round(sd(size_mm),2), 
            samp_size = n())

# Convert summary stat df into table for display
lobster_sum %>% 
  kable(col.names = c("Year", 
                     "MPA Status", 
                     "Mean (mm)",
                     "Standard Deviation (mm)",
                     "Sample Size (count)")) %>% 
  kable_styling(bootstrap_options = c("striped", "hover"), 
                full_width = F,
                position = "center"
                )


```


In 2012, there was an `r round(abs(size_ttest_2012$estimate[1]-size_ttest_2012$estimate[2])/((size_ttest_2012$estimate[1]+size_ttest_2012$estimate[2])/2)*100,0)`% difference between lobster sizes at MPA (m = `r round(size_ttest_2012$estimate[1], 2)`mm) and non-MPA (m = `r round(size_ttest_2012$estimate[2], 2)`mm) sites. This difference is statistically significant (t(`r round(size_ttest_2012$parameter, 2)`) = `r round(size_ttest_2012$statistic, 2)`, *p* = `r round(size_ttest_2012$p.value, 4)`), with a moderate effect size (`r round(cohen_2012$estimate, 2)`). It suggests a smaller mean lobster size (95% confidence interval = `r round(size_ttest_2012$conf.int, 4)`) at MPA sites vs non-MPA sites in 2012.

In 2018, there was a `r round(abs(size_ttest_2018$estimate[1]-size_ttest_2018$estimate[2])/((size_ttest_2018$estimate[1]+size_ttest_2018$estimate[2])/2)*100,0)`% difference between lobster sizes at MPA (m = `r round(size_ttest_2018$estimate[1], 2)`mm) and non-MPA (m = `r round(size_ttest_2018$estimate[2], 2)`mm) sites. This difference was also statistically significant (t(`r round(size_ttest_2018$statistic, 2)`, *p* `r ifelse( 0.001 > size_ttest_2018$p.value, "< 0.001", paste("= ", round(size_ttest_2018$p.value, 2)))`), with a small effect size (`r round(cohen_2018$estimate, 2)`). This suggests a potentiallysmaller mean lobster size (95% confidence interval = `r round(size_ttest_2018$conf.int, 4)`) at non-MPA sites vs MPA sites in 2018.

Within MPA sites, lobster size increased by `r round((ttest_MPA$estimate[2]-ttest_MPA$estimate[1])/ttest_MPA$estimate[1]*100,0)`% from 2012 (m = `r round(ttest_MPA$estimate[1], 2)`mm) to 2018 (m = `r round(ttest_MPA$estimate[2], 2)`mm), following the establishment of the MPAs. The increase was statistically significant (t(`r round(ttest_MPA$parameter, 2)`) = `r round(ttest_MPA$statistic, 2)`, *p* `r ifelse( 0.001 > ttest_MPA$p.value, "< 0.001", paste("= ", round(ttest_MPA$p.value, 4)))`), with a large effect size (`r round(cohen_MPA$estimate, 2)`).

Within non-MPA sites, there was not a significant difference (t(`r round(ttest_nonMPA$parameter, 2)`) = `r round(ttest_nonMPA$statistic, 2)`, *p* `r ifelse( 0.001 > ttest_nonMPA$p.value, "< 0.001", paste("= ", round(ttest_nonMPA$p.value,2)))`), and a negligible effect size (`r round(cohen_nonMPA$estimate, 2)`), between mean lobster size in 2012 (m = `r round(ttest_nonMPA$estimate[1], 2)`mm) compared with 2018 (m = `r round(ttest_nonMPA$estimate[2], 2)`mm).

\

### Summary
- There is sufficient evidence to suggest that lobster abundance has increased at MPA sites since the establishment of MPAs (Figure 2), and that lobster size has increased at MPA sites since the establishment of MPAs (Figure 3). 
- In addition, mean lobster size at MPA sites has improved from being less than that of non-MPA sites in 2012 to being greater than mean size at non-MPA sites in 2018 (Table 1).
- These findings could indicate that protected areas create conditions to foster growth and reproduction better than non-protected areas. 

\

### References
**California Department of Fish and Wildlife (CDFW). 2017.** [South Coast Fishery Spotlight: California Spiny Lobster.](https://nrm.dfg.ca.gov/FileHandler.ashx?DocumentID=141295&inline)

**California Department of Fish and Wildlife (CDFW). 2019.** [Current 2019-2020 Recreational Lobster Fishing Information.](https://www.wildlife.ca.gov/Conservation/Marine/Invertebrates/Lobster)

**Reed D. 2019.** [SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012.](https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0) Environmental Data Initiative. Dataset accessed 10/30/2019.

